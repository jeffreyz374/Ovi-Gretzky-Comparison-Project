---
title: "Tale Of Two Great Goal Scorers: An Analysis Of How Alex Ovechkin And Wayne Gretzky's Goals Impact Their Teams' Chances Of Winning"
author: "Xiaotang (Jeffrey) Zhou"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

This website hosts the interactive visualizations that pertain to data collected on the goals scored by National Hockey League (NHL) players Alexander Ovechkin and Wayne Gretzky, two of the greatest goal scorers in NHL history. These visualizations are part of the wider project that seeks to assess which of these goal scoring talents had the greater impact goal scoring wise on the teams they played for in terms of odds of winning games.

In this project, data was collected on the goals scored by Ovechkin and Gretzky as well as on the games they potentially could have played over their respective careers. Then, for each of these potential games, various types of goals that each player scored (i.e. even strength goals, power play goals, etc.) were aggregated, and these counts and other predictors were fitted to an ordinal logistic regression model with the response being the result of the game from the perspective of the team Ovechkin or Gretzky played on. The coefficients of the regression model were then interpreted to determine how each predictor influenced the odds of a better result for both players' teams. 

Note that as Ovechkin is currently an active player in the NHL, any data corresponding to him is accurate as of the last update to this website. This update was most recently performed on February 2nd 2025.

To read the full methodology and results, click [here](https://github.com/jeffreyz374/Ovi-Gretzky-Comparison-Project/raw/main/Final-Report.pdf) to download the final project report.

To visit Stathead and Hockey Reference, the initial sources of the data pre-cleaning, click on their names at the top right corner.

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}

library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)
library(RCurl)

# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px",
  class.source = "code-r")

ovi_data <- getURL("https://raw.githubusercontent.com/jeffreyz374/JSC370_Project/main/Data/ovi-data.csv")
ovi_data <- read.csv(text = ovi_data)
  

gretzky_data <- getURL("https://raw.githubusercontent.com/jeffreyz374/JSC370_Project/main/Data/gretzky-data.csv")
gretzky_data <- read.csv(text = gretzky_data)

ovi_goals_by_date <- ovi_data %>%
  group_by(Date) %>%
  summarise(Goals = n())

unique_date_opponent_pairs <- ovi_data %>%
  select(c("Date", "Opponent")) %>%
  distinct(Date, Opponent)

ovi_goals_by_date <- merge(ovi_goals_by_date, unique_date_opponent_pairs)

caps_wins_by_date <- ovi_data %>%
  distinct(Date, Result)

x_ovi <- merge(ovi_goals_by_date, caps_wins_by_date)

gretzky_goals_by_date <- gretzky_data %>%
  group_by(Date) %>%
  summarise(Goals = n())

wins_by_date <- gretzky_data %>%
  distinct(Date, Result)

x_gretzky <- merge(gretzky_goals_by_date, wins_by_date)

ovi_potential_games <- getURL("https://raw.githubusercontent.com/jeffreyz374/JSC370_Project/main/Data/ovi-potential-games.csv")
ovi_potential_games <- read.csv(text = ovi_potential_games)

gretzky_potential_games <- getURL("https://raw.githubusercontent.com/jeffreyz374/JSC370_Project/main/Data/gretzky-potential-games.csv")
gretzky_potential_games <- read.csv(text = gretzky_potential_games)

name_table <- getURL("https://raw.githubusercontent.com/jeffreyz374/JSC370_Project/main/Data/name-table.csv")
name_table <- read.csv(text = name_table)

```

```{r, echo = FALSE}
# datatable2 - datatable with child rows
datatable2 <- function(x, vars = NULL, opts = NULL, ...) {
  
  names_x <- names(x)
  if (is.null(vars)) stop("'vars' must be specified!")
  pos <- match(vars, names_x)
  if (any(map_chr(x[, pos], typeof) == "list"))
    stop("list columns are not supported in datatable2()")
  
  pos <- pos[pos <= ncol(x)] + 1
  rownames(x) <- NULL
  if (nrow(x) > 0) x <- cbind(' ' = '&oplus;', x)

  # options
  opts <- c(
    opts, 
    list(
      columnDefs = list(
        list(visible = FALSE, targets = c(0, pos)),
        list(orderable = FALSE, className = 'details-control', targets = 1),
        list(className = 'dt-left', targets = 1:3),
        list(className = 'dt-right', targets = 4:ncol(x))
      )
  ))
  
  datatable(
    x, 
    ...,
    escape = -2,
    options = opts,
    callback = JS(.callback2(x = x, pos = c(0, pos)))
  )
}

.callback2 <- function(x, pos = NULL) {
  
  part1 <- "table.column(1).nodes().to$().css({cursor: 'pointer'});"
  
  part2 <- .child_row_table2(x, pos = pos)
  
  part3 <- 
  "
   table.on('click', 'td.details-control', function() {
    var td = $(this), row = table.row(td.closest('tr'));
    if (row.child.isShown()) {
      row.child.hide();
      td.html('&oplus;');
    } else {
      row.child(format(row.data())).show();
      td.html('&ominus;');
    }
  });"
  
  paste(part1, part2, part3)
} 

.child_row_table2 <- function(x, pos = NULL) {
  
  names_x <- paste0(names(x), ":")
  text <- "
  var format = function(d) {
    text = '<div><table >' + 
  "

  for (i in seq_along(pos)) {
    text <- paste(text, glue::glue(
        "'<tr>' +
          '<td>' + '{names_x[pos[i]]}' + '</td>' +
          '<td>' + d[{pos[i]}] + '</td>' +
        '</tr>' + " ))
  }

  paste0(text,
    "'</table></div>'
      return text;};"
  )
}
```

```{r, echo = FALSE}
ovi_data_copy <- ovi_data
ovi_data_copy[is.na(ovi_data_copy)] <- "N/A"
ovi_data_copy$PS <- case_when(ovi_data_copy$PS == 0 ~ "No", ovi_data_copy$PS == 1 ~ "Yes")
ovi_data_copy$ENG <- case_when(ovi_data_copy$ENG == 0 ~ "No", ovi_data_copy$ENG == 1 ~ "Yes")
ovi_data_copy$Result <- case_when(ovi_data_copy$Result == "W" ~ "Regulation Win",
                                  ovi_data_copy$Result == "L" ~ "Regulation Loss",
                                  ovi_data_copy$Result == "OTW" ~ "Overtime Win",
                                  ovi_data_copy$Result == "OTL" ~ "Overtime Loss",
                                  ovi_data_copy$Result == "SOW" ~ "Shootout Win",
                                  ovi_data_copy$Result == "SOL" ~ "Shootout Loss")
ovi_data_copy$HomeAway <- case_when(ovi_data_copy$HomeAway == "H" ~ "Home", ovi_data_copy$HomeAway == "A" ~ "Away")
ovi_data_copy$Strength <- case_when(ovi_data_copy$Strength == "EV" ~ "Even Strength", ovi_data_copy$Strength == "PP" ~ "Power Play", ovi_data_copy$Strength == "SH" ~ "Shorthanded")
ovi_data_copy$Time <- substr(ovi_data_copy$Time, start = 1, stop = 5)
ovi_data_copy$Period <- case_when(ovi_data_copy$Period == 1 ~ "1st", ovi_data_copy$Period == 2 ~ "2nd", ovi_data_copy$Period == 3 ~ "3rd", ovi_data_copy$Period == "OT" ~ "Overtime")
ovi_data_copy$Team <- rep("Washington Capitals", nrow(ovi_data_copy))

ovi_data_copy <- merge(ovi_data_copy, name_table, by.x = c("Opponent"), by.y = c("Abbreviation"))

ovi_data_copy <- ovi_data_copy[c(2:ncol(ovi_data_copy))]

colnames(ovi_data_copy) <- c("Date", "Team", "Age (years)", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Home/Away", "Result", "Empty Net Goal", "Penalty Shot Goal", "Opponent")

ovi_data_copy <- ovi_data_copy[, c(1, 2, 15, 3:14)]

ovi_data_copy <- left_join(ovi_data_copy, ovi_potential_games[c(1, 3, 4)], by = "Date") %>%
  mutate(Final = paste(GF, "-", GA))

ovi_data_copy <- ovi_data_copy[, c(1:13, 18, 14:15)]

colnames(ovi_data_copy) <- c("Date", "Team", "Opponent", "Age (years)", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Home/Away", "Result", "Final Score", "Empty Net Goal", "Penalty Shot Goal")

ovi_data_copy <- ovi_data_copy %>%
  arrange(desc(Date), desc(Period), desc(Time))

ovi_data_copy$cgoal <- rev(c(1:nrow(ovi_data_copy)))

ovi_data_copy <- ovi_data_copy[, c(1:4, 17, 5:16)]

colnames(ovi_data_copy) <- c("Date", "Team", "Opponent", "Age (years)", "Career Goal Number", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Home/Away", "Result", "Final Score", "Empty Net Goal", "Penalty Shot Goal")
```

```{r, echo = FALSE}
gretzky_data_copy <- gretzky_data
gretzky_data_copy[is.na(gretzky_data_copy)] <- "N/A"
gretzky_data_copy$PS <- case_when(gretzky_data_copy$PS == 0 ~ "No", gretzky_data_copy$PS == 1 ~ "Yes")
gretzky_data_copy$ENG <- case_when(gretzky_data_copy$ENG == 0 ~ "No", gretzky_data_copy$ENG == 1 ~ "Yes")
gretzky_data_copy$Result <- case_when(gretzky_data_copy$Result == "W" ~ "Regulation Win",
                                      gretzky_data_copy$Result == "L" ~ "Regulation Loss",
                                      gretzky_data_copy$Result == "OTW" ~ "Overtime Win",
                                      gretzky_data_copy$Result == "OTL" ~ "Overtime Loss",
                                      gretzky_data_copy$Result == "T" ~ "Tie")
gretzky_data_copy$HomeAway <- case_when(gretzky_data_copy$HomeAway == "H" ~ "Home", gretzky_data_copy$HomeAway == "A" ~ "Away")
gretzky_data_copy$Strength <- case_when(gretzky_data_copy$Strength == "EV" ~ "Even Strength", gretzky_data_copy$Strength == "PP" ~ "Power Play", gretzky_data_copy$Strength == "SH" ~ "Shorthanded")
gretzky_data_copy$Time <- substr(gretzky_data_copy$Time, start = 12, stop = 16)
gretzky_data_copy$Period <- case_when(gretzky_data_copy$Period == 1 ~ "1st", gretzky_data_copy$Period == 2 ~ "2nd", gretzky_data_copy$Period == 3 ~ "3rd", gretzky_data_copy$Period == "OT" ~ "Overtime")
gretzky_data_copy$Team <- case_when(gretzky_data_copy$Team == "EDM" ~ "Edmonton Oilers",
                                    gretzky_data_copy$Team == "LAK" ~ "Los Angeles Kings",
                                    gretzky_data_copy$Team == "STL" ~ "St. Louis Blues",
                                    gretzky_data_copy$Team == "NYR" ~ "New York Rangers")

gretzky_data_copy <- merge(gretzky_data_copy, name_table, by.x = c("Opponent"), by.y = c("Abbreviation"))

gretzky_data_copy <- gretzky_data_copy[c(2:ncol(gretzky_data_copy))]

colnames(gretzky_data_copy) <- c("Date", "Team", "Age (years)", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Result", "Home/Away", "Empty Net Goal", "Penalty Shot Goal", "Opponent")

gretzky_data_copy <- gretzky_data_copy[, c(1, 2, 15, 3:10, 12, 11, 13, 14)]

gretzky_data_copy <- left_join(gretzky_data_copy, gretzky_potential_games[c(1, 3, 4)], by = "Date") %>%
  mutate(Final = paste(GF, "-", GA))

gretzky_data_copy <- gretzky_data_copy[, c(1:13, 18, 14:15)]

colnames(gretzky_data_copy) <- c("Date", "Team", "Opponent", "Age (years)", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Home/Away", "Result", "Final Score", "Empty Net Goal", "Penalty Shot Goal")

gretzky_data_copy <- gretzky_data_copy %>%
  arrange(desc(Date), desc(Period), desc(Time))

gretzky_data_copy$cgoal <- rev(c(1:894))

gretzky_data_copy <- gretzky_data_copy[, c(1:4, 17, 5:16)]

colnames(gretzky_data_copy) <- c("Date", "Team", "Opponent", "Age (years)", "Career Goal Number", "1st Assist", "2nd Assist", "Goalie", "Period", "Time", "Strength", "Arena", "Home/Away", "Result", "Final Score", "Empty Net Goal", "Penalty Shot Goal")
```

```{css, echo = FALSE}
.code-r { /* Code block */
  font-size: 15px;
}

.code-r-small { /* Code block */
  font-size: 10px;
}
```

<br>

## Frequencies of Outcomes In Games Where Ovechkin and Gretzky Scored Goals {.tabset}

This is an interactive version of Figures 1 and 2 in the report, which collectively show the frequencies of the outcomes of games for Ovechkin and Gretzky's teams when Ovechkin and Gretzky score at least one goal.

Note that as Ovechkin is currently an active player in the NHL, any data corresponding to him is accurate as of the last update to this website. This update was most recently performed on February 2nd 2025.

```{r, echo = FALSE}
ovi_goal_wins <- ovi_data_copy %>%
  select(c("Date", "Result")) %>%
  distinct(Date, Result) %>%
  group_by(Result) %>%
  summarise(Frequency = n())

gretzky_goal_wins <- gretzky_data_copy %>%
  select(c("Date", "Result")) %>%
  distinct(Date, Result) %>%
  group_by(Result) %>%
  summarise(Frequency = n())

ovi_goal_wins <- ovi_goal_wins %>%
  ggplot(aes(x = Result, y = Frequency)) +
  geom_bar(stat = "identity", fill = "red") +
  ggtitle("Frequencies of different game outcomes for Ovechkin's team \n when Ovechkin scores at least one goal") +
  scale_x_discrete(limits = c("Regulation Win", "Overtime Win", "Shootout Win",
                              "Shootout Loss", "Overtime Loss", "Regulation Loss")) +
  theme_minimal()

gretzky_goal_wins <- gretzky_goal_wins %>%
  ggplot(aes(x = Result, y = Frequency)) +
  geom_bar(stat = "identity", fill = "blue") +
  ggtitle("Frequencies of different game outcomes for Gretzky's team \n when Gretzky scores at least one goal") +
  scale_x_discrete(limits = c("Regulation Win", "Overtime Win", "Tie", 
                              "Overtime Loss", "Regulation Loss")) +
  theme_minimal()
```

### Ovechkin

```{r, echo = FALSE}
ggplotly(ovi_goal_wins) %>%
  layout(hoverlabel=list(bgcolor="white"))
```

### Gretzky

```{r, echo = FALSE}
ggplotly(gretzky_goal_wins) %>%
  layout(hoverlabel=list(bgcolor="white"))
```

## {-}

<br>

## Frequencies of Outcomes In Games Where Ovechkin and Gretzky DID NOT Score a Goal {.tabset}

This is an interactive version of Figures 1 and 2 in the report, which collectively show the outcomes of games for Ovechkin and Gretzky's teams when Ovechkin and Gretzky DID NOT score a goal

Note that as Ovechkin is currently an active player in the NHL, any data corresponding to him is accurate as of the last update to this website. This update was most recently performed on February 2nd 2025.

```{r, echo = FALSE}
missing_ovi_games <- ovi_potential_games %>%
  filter(Date %in% setdiff(ovi_potential_games$Date, x_ovi$Date))

missing_gretzky_games <- gretzky_potential_games %>%
  filter(Date %in% setdiff(gretzky_potential_games$Date, x_gretzky$Date))

ovi_nogoal_wins <- missing_ovi_games %>%
  mutate(Result = case_when(Result == "W" ~ "Regulation Win",
                            Result == "OTW" ~ "Overtime Win",
                            Result == "SOW" ~ "Shootout Win",
                            Result == "SOL" ~ "Shootout Loss",
                            Result == "OTL" ~ "Overtime Loss",
                            Result == "L" ~ "Regulation Loss")) %>%
  group_by(Result) %>%
  summarise(Frequency = n())

gretzky_nogoal_wins <- missing_gretzky_games %>%
  mutate(Result = case_when(Result == "W" ~ "Regulation Win",
                            Result == "OTW" ~ "Overtime Win",
                            Result == "T" ~ "Tie",
                            Result == "OTL" ~ "Overtime Loss",
                            Result == "L" ~ "Regulation Loss")) %>%
  group_by(Result) %>%
  summarise(Frequency = n())

ovi_nogoal_wins <- ovi_nogoal_wins %>%
  ggplot(aes(x = Result, y = Frequency)) +
  geom_bar(stat = "identity", fill = "red") +
  ggtitle("Frequencies of different game outcomes for Ovechkin's team \n when Ovechkin DOES NOT score a goal") +
  scale_x_discrete(limits = c("Regulation Win", "Overtime Win", "Shootout Win",
                              "Shootout Loss", "Overtime Loss", "Regulation Loss")) +
  theme_minimal()

gretzky_nogoal_wins <- gretzky_nogoal_wins %>%
  ggplot(aes(x = Result, y = Frequency)) +
  geom_bar(stat = "identity", fill = "blue") +
  ggtitle("Frequencies of different game outcomes for Gretzky's team \n when Gretzky DOES NOT score a goal") +
  scale_x_discrete(limits = c("Regulation Win", "Overtime Win", "Tie",
                              "Overtime Loss", "Regulation Loss")) +
  theme_minimal()
```

### Ovechkin

```{r, echo = FALSE}
ggplotly(ovi_nogoal_wins) %>%
  layout(hoverlabel=list(bgcolor="white"))
```

### Gretzky

```{r, echo = FALSE}
ggplotly(gretzky_nogoal_wins) %>%
  layout(hoverlabel=list(bgcolor="white"))
```

## {-}

<br>

## Information About Every Ovechkin and Gretzky Goal {.tabset}

This interactive visual displays information about all of the goals that Ovechkin and Gretzky have scored 

Note that as Ovechkin is currently an active player in the NHL, any data corresponding to him is accurate as of the last update to this website. This update was most recently performed on February 2nd 2025.

### Ovechkin

```{r, echo = FALSE}
datatable2(x = ovi_data_copy, vars = colnames(ovi_data_copy)[-c(1, 2, 3, 5)])
```

### Gretzky

```{r, echo = FALSE}
datatable2(x = gretzky_data_copy, vars = colnames(gretzky_data_copy)[-c(1, 2, 3, 5)])
```

## {-}

